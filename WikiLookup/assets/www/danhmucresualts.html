<html>
<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta charset="utf-8">
	<style type="text/css">
		html,body {
			height: 100%;
			margin: 0;
			padding: 0;
		}
	
		#map_canvas {
			height: 100%;
		}
		
		@media print {
			html,body {
				height: auto;
			}
			#map_canvas {
				height: 100%;
			}
		}
	</style>
	<script	src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=places&language=vi"></script>
	<script>
		var map, placesList;
		function initialize() {
			// Lấy dữ liệu transfer
			var mySearch = location.search.substr(1);
			var x = mySearch.toString().indexOf('@');
			var y = mySearch.toString().indexOf('%');
			var lat = mySearch.toString().substr(0, x);
			var lon = mySearch.toString().substr(x + 1, y - x - 1);
			var key = mySearch.toString().substr(y + 1);
			
			// Vị trí hiển thị khi bản đồ hiển thị lần đầu tiên
			var pyrmont = new google.maps.LatLng(lat, lon);
			// Khởi tạo bản đồ
			map = new google.maps.Map(document.getElementById('map_canvas'), {
				mapTypeId : google.maps.MapTypeId.ROADMAP,
				center : pyrmont,
				zoom : 15
			});

			var place_type = document.getElementById('place_type');

			var request = {
					location: pyrmont,
					radius: 2000,
					types: [key] 
			}; 
			
			// Hiển thị thông tin về địa điểm
			infowindow = new google.maps.InfoWindow();
			var service = new google.maps.places.PlacesService(map);
			
			// Thực hiện gọi hàm nearbySearch để tìm những atm lân cận và trả về thực hiện
			// hàm callback
			service.nearbySearch(request, callback);
		}

		
		function callback(results, status) {
			if (status == google.maps.places.PlacesServiceStatus.OK) {
				for ( var i = 0; i < results.length; i++) {
					// Duyệt từng địa điểm và đánh dấu lên bản đồ
					createMarker(results[i]);
				}
			}
		}
		
		// Hàm đánh dấu lên bản đồ từ 1 đối tượng địa điểm place
		function createMarker(place) {
			var placeLoc = place.geometry.location;
			var marker = new google.maps.Marker({
			map: map,
			position: place.geometry.location
			});

			google.maps.event.addListener(marker, 'click', function() {
				infowindow.setContent(place.name);
				infowindow.open(map, this);
				});
		}
		
		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
</head>
<body>
	<div id="map_canvas"></div>
</body>
</html>